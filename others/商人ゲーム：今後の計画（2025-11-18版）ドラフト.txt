商人ゲーム：今後の計画（2025-11-18版）ドラフト

[シナリオ]
- 現状：Dialog.gd + DialogPlayer.gd + dialogs.csv で会話再生は可能だが、本編シナリオは未整備。
- 目的：序盤～チュートリアル部分だけでも「導線付きの短い物語」を用意する。
- 当面TODO：
  * ゲーム開始～最初の契約達成までの会話ラフを文章で書く
  * ラフをdialogs.csv形式（id/seq/speaker/text/portrait）に落とす
  * world / HUD から各シーンを再生するトリガー条件を列挙する

[各データ（CSV群）]
- 現状：cities/products/routes/city_stock/events系/契約系など主要テーブルは揃ってきている。
- 課題：カテゴリ・tier・定期市・評判など、今後増える列の設計が暫定。
- 当面TODO：
  * data一覧に「今後追加する列」メモを追記（値は空でもよい）
  * products.csvのcategoryをworld.gd側のカテゴリと揃える
  * 定期市で扱う商品に印を付けるための列案を決める

[商館システム]
- 現状：PDFにMVP仕様あり。実装は未着手（契約と接続する想定）。
- 目的：行商プレイを主役にしつつ、委託販売・情報・支店NPCで「受動収益と快適さ」を足す。
- 当面TODO：
  * worldのセーブデータにplayer_branches用の空枠を追加
  * Menu/Tradeのどこかに商館タブ（ダミーUI）を追加して項目だけ置く
  * 月末に「商館利益報告」ログを出す場所を予約（中身は後回し可）

[定期市]
- 現状：enable_fairs/_tick_fairsなど枠だけある。中で何が起きるかは未決定。
- 目的：特定の日に特定都市で「特定カテゴリの品が多く・やや安く」流れるイベントを作る。
- 当面TODO：
  * 定期市のスケジュールをどのCSVで持つか決める（専用CSV or cities.csvの列）
  * _tick_fairs()内で「開催都市の対象商品だけtarget_stock増量＋価格微調整」する簡易版を実装
  * HUD/会話で「◯月◯日から△△市開催」の告知を出す

[護衛]
- 現状：危険度＋護衛レベルで旅行イベントの重みを変えるフックはあるが、UIとデータが未整備。
- 目的：危険ルートほど稼げるが、護衛コストも踏まえて悩ませる要素にする。
- 当面TODO：
  * move_windowなどに護衛レベル選択UI（0～2段階）を追加し、playerにescort_levelを持たせる
  * 危険度をroutes.csvか専用マップで管理する方針を決める
  * 旅行イベントのフレーバー文を護衛あり/なしで少し変える

[UIアセット化]
- 現状：HUD/Trade/Menu/Dialogごとにスタイル指定が散らばっている。
- 目的：Theme/StyleBoxで見た目を揃え、後から配色変更しやすくする。
- 当面TODO：
  * 共通テーマファイル（main_theme.tresなど）を作り、HUD/メニュー/ダイアログで共有
  * Dialog.gdで自前生成しているStyleBoxをテーマ側に移管する
  * トーストやイベントログ用のStyleBoxも共通定義に寄せる

[評判システム]
- 現状：設計メモのみ。実装は未着手。
- 目的：契約失敗や買い占め、定期市での活躍などを「数字として残す」ことで世界の反応を作る。
- 当面TODO：
  * worldに都市別・全体の評判用フィールドを追加（値は0固定でもよい）
  * どの行為でどれくらい変動させるか、簡単なテーブルを作る
  * HUDやメニューに評判を1行だけ表示する場所を確保する

[NPCとの交流]
- 現状：イベントのフレーバー＋無言トレーダーが中心。
- 目的：ギルド職員や支店NPCなど、顔のある相手とのやり取りで世界に手触りを足す。
- 当面TODO：
  * 「案内人／ギルド受付／支店長」など、顔出しNPC候補のリストアップ
  * dialogs.csvにNPC別の定型セリフ（画面オープン時の一言など）を追加
  * HUD/Menuから特定UIを開いたときに対応するdialog_idを再生するフックを用意

(以上、ドラフト。実装の進み具合に合わせて適宜更新すること。)
